<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Schola Arcana ‚Äî Dossier</title>
  <meta name="description" content="ETH + Master‚Äôs dossier tracker: CV, SOP, writing sample, deadlines, recommenders. Autosave + export." />
  <style>
    :root{
      --bg:#fff7fb;
      --card:#ffffffcc;
      --ink:#1f1630;
      --muted:#5b4b66;
      --pink:#ff4da6;
      --pink2:#ff77c2;
      --lav:#b18cff;
      --mint:#5fe2c2;
      --gold:#ffd36e;
      --line:#f2c9df;
      --shadow: 0 18px 40px rgba(31,22,48,.10);
      --shadow2: 0 10px 24px rgba(31,22,48,.08);
      --radius: 22px;
      --radius2: 16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--ink);
      background:
        radial-gradient(1200px 700px at 10% 10%, #ffe0f0 0%, transparent 60%),
        radial-gradient(1000px 700px at 90% 20%, #f0e3ff 0%, transparent 55%),
        radial-gradient(900px 600px at 50% 90%, #e6fff7 0%, transparent 60%),
        linear-gradient(180deg, var(--bg) 0%, #ffffff 100%);
      overflow-x:hidden;
    }
    a{color:inherit}
    .wrap{max-width:1280px;margin:0 auto;padding:26px 18px 70px}
    .hero{
      position:relative;
      border:1px solid var(--line);
      border-radius:var(--radius);
      background: linear-gradient(135deg, #ffffffcc, #fff0f8cc);
      box-shadow:var(--shadow);
      padding:24px 22px;
      overflow:hidden;
    }
    .hero:before{
      content:"";
      position:absolute; inset:-45px -70px auto auto;
      width:320px;height:320px;
      background:
        radial-gradient(circle at 30% 30%, #ffb3da 0%, transparent 58%),
        radial-gradient(circle at 70% 70%, #c7b0ff 0%, transparent 58%);
      filter: blur(2px);
      transform: rotate(14deg);
      opacity:.9;
      pointer-events:none;
    }
    .sparkle{
      display:inline-block;
      background: linear-gradient(135deg, var(--pink), var(--lav));
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
      font-weight:950;
      letter-spacing:-.01em;
    }
    .hero h1{
      margin:0 0 8px;
      font-size: clamp(26px, 3.0vw, 42px);
      letter-spacing:-.02em;
      line-height:1.05;
    }
    .muted{color:var(--muted)}
    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin-top:12px}
    .badge{
      border:1px solid var(--line);
      background:#fff;
      border-radius:999px;
      padding:8px 12px;
      font-size:13px;
      color:var(--muted);
      display:flex; gap:8px; align-items:center;
      box-shadow:0 8px 18px rgba(31,22,48,.06);
    }
    .dot{width:8px;height:8px;border-radius:50%}
    .dot.pink{background:var(--pink)}
    .dot.lav{background:var(--lav)}
    .dot.mint{background:var(--mint)}
    .dot.gold{background:var(--gold)}

    .btn{
      border:1px solid var(--line);
      background: linear-gradient(180deg, #fff, #fff7fb);
      border-radius:999px;
      padding:10px 14px;
      font-weight:900;
      font-size:13px;
      cursor:pointer;
      box-shadow:0 10px 18px rgba(31,22,48,.06);
      transition: transform .08s ease, border-color .2s ease;
      user-select:none;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .btn:hover{transform: translateY(-1px); border-color:#f0a7cd}
    .btn.primary{
      border-color: transparent;
      background: linear-gradient(135deg, var(--pink), var(--pink2));
      color:white;
    }
    .btn.ghost{background:transparent; box-shadow:none;}
    .pill{
      font-family:var(--mono);
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:#fff;
      color:var(--muted);
      white-space:nowrap;
    }

    .grid{
      margin-top:14px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      align-items:start;
    }
    @media (max-width: 980px){ .grid{grid-template-columns:1fr} }

    .card{
      border:1px solid var(--line);
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      padding:14px;
      backdrop-filter: blur(8px);
    }
    .card h2{
      margin:0 0 10px;
      font-size:16px;
      letter-spacing:-.01em;
      display:flex; align-items:center; gap:10px;
    }
    .hr{
      height:1px;
      background:#f7d8e8;
      margin:12px 0;
      border:none;
    }

    label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px}
    input, textarea, select{
      width:100%;
      border:1px solid var(--line);
      border-radius:18px;
      background:#fff;
      padding:12px;
      font-family:var(--sans);
      outline:none;
      box-shadow:0 10px 18px rgba(31,22,48,.05);
    }
    textarea{min-height:110px;resize:vertical;line-height:1.5}
    textarea:focus, input:focus, select:focus{border-color:#f0a7cd}
    .row2{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .kpis{
      display:grid;
      grid-template-columns: repeat(3,1fr);
      gap:10px;
      margin-top:10px;
    }
    @media (max-width: 760px){ .kpis{grid-template-columns:1fr} }
    .kpi{
      border:1px solid var(--line);
      background:#fff;
      border-radius:18px;
      padding:12px;
      box-shadow:0 10px 18px rgba(31,22,48,.05);
    }
    .kpi .label{font-size:12px;color:var(--muted);margin-bottom:6px}
    .kpi .value{font-weight:950;font-size:16px}
    .kpi .sub{font-size:12px;color:var(--muted);margin-top:4px;line-height:1.45}

    /* tables */
    .tableWrap{overflow:auto; border-radius:18px; border:1px solid var(--line); background:#fff}
    table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      min-width: 980px;
      font-size:13px;
    }
    thead th{
      position:sticky; top:0;
      background: linear-gradient(180deg, #fff, #fff7fb);
      border-bottom:1px solid var(--line);
      text-align:left;
      padding:12px 12px;
      font-size:12px;
      color:var(--muted);
      letter-spacing:.03em;
      text-transform:uppercase;
      z-index:1;
    }
    tbody td{
      vertical-align:top;
      padding:12px 12px;
      border-bottom:1px solid #f7d8e8;
      color:var(--ink);
      background:#fff;
      line-height:1.45;
    }
    tbody tr:hover td{background:#fff7fb}
    .mono{font-family:var(--mono)}
    .small{font-size:12px;color:var(--muted)}
    .status{
      display:inline-flex;align-items:center;gap:8px;
      border:1px solid var(--line);
      padding:6px 10px;
      border-radius:999px;
      background:#fff7fb;
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
    }
    .status b{color:var(--ink)}
    footer{
      margin-top:16px;
      color:var(--muted);
      font-size:12px;
      text-align:center;
      line-height:1.55;
    }
    @media print{
      .row, .kpis, #exportBtn, #resetBtn {display:none !important}
      body{background:#fff}
      .hero, .card{box-shadow:none}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header class="hero">
      <h1><span class="sparkle">Schola Arcana</span> ‚Äî Dossier</h1>
      <p class="muted" style="margin:0;max-width:95ch">
        This is your <b>application package tracker</b> (ETH SRF + Master‚Äôs): CV, SOP, writing sample, deadlines, and recommenders.
        Autosaves locally + exports to Markdown so you can paste into Notion or a private repo.
      </p>

      <div class="row">
        <div class="badge"><span class="dot pink"></span> Narrative + evidence</div>
        <div class="badge"><span class="dot lav"></span> Versioning mindset</div>
        <div class="badge"><span class="dot mint"></span> ‚ÄúProof voice‚Äù assets</div>
        <div class="badge"><span class="dot gold"></span> Export ‚Üí Markdown</div>
      </div>

      <div class="row" style="margin-top:12px">
        <a class="btn ghost" href="index.html">‚Üê Back to Cathedral Semester</a>
        <a class="btn ghost" href="journal.html">‚Üí Journal</a>
        <a class="btn ghost" href="vault.html">‚Üí Proof Vault</a>
        <button class="btn primary" id="exportBtn">Export dossier (Markdown)</button>
        <button class="btn" id="resetBtn">Reset dossier</button>
        <button class="btn ghost" id="printBtn">Print / PDF</button>
      </div>

      <div class="kpis">
        <div class="kpi">
          <div class="label">Dossier rule</div>
          <div class="value">Every doc has versions</div>
          <div class="sub">CV v1 ‚Üí v2 ‚Üí final. SOP outline ‚Üí ugly draft ‚Üí v2 ‚Üí final.</div>
        </div>
        <div class="kpi">
          <div class="label">Writing sample target</div>
          <div class="value">10‚Äì15 pages</div>
          <div class="sub">A proof-heavy exposition. Clean structure. References.</div>
        </div>
        <div class="kpi">
          <div class="label">Recommendation strategy</div>
          <div class="value">Make it easy for them</div>
          <div class="sub">Give CV + 1-page brag sheet + 2 proof artifacts + deadlines.</div>
        </div>
      </div>
    </header>

    <section class="grid">
      <!-- CV -->
      <div class="card">
        <h2>CV tracker <span class="pill">versions + content</span></h2>

        <div class="row2">
          <div style="flex:1 1 200px">
            <label for="cvVersion">Current version</label>
            <select id="cvVersion">
              <option value="v0">v0 (skeleton)</option>
              <option value="v1">v1 (complete)</option>
              <option value="v2">v2 (polished)</option>
              <option value="final">final</option>
            </select>
          </div>
          <div style="flex:1 1 320px">
            <label for="cvLink">CV file/link</label>
            <input id="cvLink" type="text" placeholder="docs/CV_AnaPaola_2026.pdf" />
          </div>
        </div>

        <div style="height:10px"></div>

        <label for="cvBullets">Key bullets to include (math/theory-coded)</label>
        <textarea id="cvBullets" placeholder="- Weekly proof artifacts (Sipser/Axler)\n- Automata Lab (regex‚ÜíNFA‚ÜíDFA + viz)\n- Quantum mini-simulator (Deutsch‚ÄìJozsa + Grover)\n- Research interests: computability, complexity, quantum information"></textarea>

        <div style="height:10px"></div>

        <label for="cvNotes">CV notes / fixes</label>
        <textarea id="cvNotes" placeholder="- Tighten language (remove SWE fluff)\n- Add metrics/screenshots\n- Add coursework: TOC, Discrete, Linear Algebra (self-study)"></textarea>

        <div class="small" style="margin-top:10px">
          Tip: your CV should read like <b>‚Äútheoretical CS + math person who can build‚Äù</b>, not ‚Äúgeneric SWE student‚Äù.
        </div>
      </div>

      <!-- SOP -->
      <div class="card">
        <h2>Statement of Purpose <span class="pill">structure + drafts</span></h2>

        <div class="row2">
          <div style="flex:1 1 220px">
            <label for="sopStage">Stage</label>
            <select id="sopStage">
              <option value="outline">outline</option>
              <option value="ugly">ugly draft</option>
              <option value="v2">v2 coherent</option>
              <option value="final">final</option>
            </select>
          </div>
          <div style="flex:1 1 320px">
            <label for="sopLink">SOP file/link</label>
            <input id="sopLink" type="text" placeholder="docs/SOP_TheoreticalCS_2026.md" />
          </div>
        </div>

        <div style="height:10px"></div>

        <label for="sopThesis">One-sentence thesis (identity)</label>
        <input id="sopThesis" type="text" placeholder="I‚Äôm building a proof-driven foundation in computation + linear algebra to pursue research in complexity and quantum computation." />

        <div style="height:10px"></div>

        <label for="sopOutline">SOP outline bullets (keep ruthless)</label>
        <textarea id="sopOutline" placeholder="- Origin story: why theory/axioms\n- What I‚Äôm doing now: Sipser/Axler/QC + proof vault\n- Projects as evidence\n- What I want to research (2‚Äì3 themes)\n- Why ETH / why this program\n- What I‚Äôll contribute"></textarea>

        <div style="height:10px"></div>

        <label for="sopNotes">Notes (what feels weak?)</label>
        <textarea id="sopNotes" placeholder="- Too broad? Narrow to complexity + quantum info\n- Need 2 faculty/lab matches per program\n- Add 1 concrete question I want to study"></textarea>
      </div>
    </section>

    <section class="grid">
      <!-- Writing sample -->
      <div class="card">
        <h2>Writing sample <span class="pill">10‚Äì15 pages</span></h2>

        <div class="row2">
          <div style="flex:1 1 180px">
            <label for="wsPages">Page count (current)</label>
            <input id="wsPages" type="number" min="0" step="1" placeholder="0" />
          </div>
          <div style="flex:2 1 360px">
            <label for="wsLink">Writing sample file/link</label>
            <input id="wsLink" type="text" placeholder="writing-sample/main.pdf" />
          </div>
        </div>

        <div style="height:10px"></div>

        <label for="wsTopic">Topic (choose one and commit)</label>
        <input id="wsTopic" type="text" placeholder="Example: Reductions as a proof language (from HALTING to NP-completeness), with clean templates." />

        <div style="height:10px"></div>

        <label for="wsAbstract">Abstract (5‚Äì8 lines)</label>
        <textarea id="wsAbstract" placeholder="What is this document about? What does it prove/explain? What is the arc?"></textarea>

        <div style="height:10px"></div>

        <label for="wsSections">Sections (outline)</label>
        <textarea id="wsSections" placeholder="1. Definitions & proof templates\n2. Regular/CFL pumping as a style of argument\n3. Halting + Rice + reduction patterns\n4. NP: verifiers, reductions, canonical problems\n5. A quantum note: linear algebra postulates & algorithm sketch\n6. Conclusion + future directions"></textarea>

        <div style="height:10px"></div>

        <label for="wsBib">Bibliography / references (rough)</label>
        <textarea id="wsBib" placeholder="- Sipser, Introduction to the Theory of Computation\n- Axler, Linear Algebra Done Right\n- Nielsen & Chuang, QCQI\n- (papers/notes as needed)"></textarea>
      </div>

      <!-- Deadlines / programs -->
      <div class="card">
        <h2>Programs & deadlines <span class="pill">ETH + master‚Äôs</span></h2>

        <div class="small" style="margin:0 0 10px">
          Put real dates when you have them. If unknown, keep ‚ÄúTBD‚Äù so your brain stops spiraling.
        </div>

        <div class="tableWrap" role="region" aria-label="Programs and deadlines">
          <table>
            <thead>
              <tr>
                <th style="width:220px">Program</th>
                <th style="width:160px">Type</th>
                <th style="width:180px">Deadline</th>
                <th>Focus / fit notes</th>
                <th style="width:200px">Status</th>
              </tr>
            </thead>
            <tbody id="progBody"></tbody>
          </table>
        </div>

        <div class="row2" style="margin-top:12px">
          <button class="btn" id="addProgram">+ Add row</button>
          <button class="btn" id="exportPrograms">Export programs</button>
        </div>
      </div>
    </section>

    <section class="grid">
      <!-- Recommenders -->
      <div class="card">
        <h2>Recommenders <span class="pill">make it easy for them</span></h2>

        <div class="tableWrap" role="region" aria-label="Recommenders table">
          <table>
            <thead>
              <tr>
                <th style="width:240px">Name</th>
                <th style="width:220px">Role</th>
                <th style="width:210px">What they can say</th>
                <th style="width:180px">Deadline</th>
                <th style="width:220px">Status</th>
              </tr>
            </thead>
            <tbody id="recBody"></tbody>
          </table>
        </div>

        <div class="row2" style="margin-top:12px">
          <button class="btn" id="addRec">+ Add recommender</button>
          <button class="btn" id="exportRecs">Export recommenders</button>
        </div>

        <hr class="hr" />

        <label for="recPacket">Recommender packet checklist (copy/paste to email)</label>
        <textarea id="recPacket" placeholder="- CV (latest)\n- SOP draft (current)\n- 1-page summary: achievements + research interests\n- 2 proof artifacts (PDF)\n- Project 1 README + demo link\n- Deadlines + submission instructions"></textarea>
      </div>

      <!-- Coherence / brag sheet -->
      <div class="card">
        <h2>Coherence sheet <span class="pill">your narrative in bullets</span></h2>

        <label for="identity">Identity (2‚Äì4 bullets)</label>
        <textarea id="identity" placeholder="- I‚Äôm axioms-first: logic ‚Üí structures ‚Üí computation limits\n- I care about proofs as a language\n- I‚Äôm building linear algebra as the backbone for QC"></textarea>

        <div style="height:10px"></div>

        <label for="themes">Research themes (pick 2‚Äì3)</label>
        <textarea id="themes" placeholder="- Computability & reductions\n- Complexity (P vs NP culture + NP-completeness)\n- Quantum computation / quantum information"></textarea>

        <div style="height:10px"></div>

        <label for="evidence">Evidence list (what proves the above?)</label>
        <textarea id="evidence" placeholder="- Proof vault: 17 weekly artifacts\n- Automata Lab project (TOC concrete)\n- Quantum simulator project (LA + QC)\n- Writing sample (10‚Äì15 pages)\n- Courses/self-study logs"></textarea>

        <div style="height:10px"></div>

        <label for="fitNotes">Program fit notes template</label>
        <textarea id="fitNotes" placeholder="For each program:\n- 2 faculty/lab matches\n- 1‚Äì2 papers I read\n- 1 question I want to explore there\n- Why that place fits my trajectory"></textarea>

        <div class="small" style="margin-top:10px">
          This card is your ‚Äúanti-scatter‚Äù device. If anything doesn‚Äôt fit the identity, it gets cut.
        </div>
      </div>
    </section>

    <footer>
      Save as <span class="mono" style="background:#fff7fb;border:1px solid var(--line);padding:2px 6px;border-radius:8px">dossier.html</span>.
      Add a button to your <span class="mono">index.html</span> CTA row to link here.
      <br/>Pink, but admissions-weaponized. üíó
    </footer>
  </div>

  <script>
    const KEY = "schola_arcana_dossier_v1";

    const DEFAULT = {
      cvVersion:"v0",
      cvLink:"",
      cvBullets:"",
      cvNotes:"",
      sopStage:"outline",
      sopLink:"",
      sopThesis:"",
      sopOutline:"",
      sopNotes:"",
      wsPages:"",
      wsLink:"",
      wsTopic:"",
      wsAbstract:"",
      wsSections:"",
      wsBib:"",
      programs:[
        {name:"ETH Zurich ‚Äî Summer Research Fellowship", type:"research summer", deadline:"TBD", notes:"Match labs. Emphasize proof maturity + projects.", status:"planning"},
        {name:"Master‚Äôs (Math/Theoretical CS) ‚Äî Target 1", type:"master‚Äôs", deadline:"TBD", notes:"Add faculty matches + reasons.", status:"planning"},
      ],
      recommenders:[
        {name:"", role:"Professor / Mentor", canSay:"Proof skill, rigor, curiosity", deadline:"TBD", status:"not asked"},
      ],
      recPacket:"",
      identity:"",
      themes:"",
      evidence:"",
      fitNotes:""
    };

    function load(){
      try{
        const raw = localStorage.getItem(KEY);
        if(!raw) return structuredClone(DEFAULT);
        const d = JSON.parse(raw);
        // merge
        const merged = {...structuredClone(DEFAULT), ...d};
        if(!Array.isArray(merged.programs)) merged.programs = structuredClone(DEFAULT.programs);
        if(!Array.isArray(merged.recommenders)) merged.recommenders = structuredClone(DEFAULT.recommenders);
        return merged;
      }catch{
        return structuredClone(DEFAULT);
      }
    }

    function save(){
      localStorage.setItem(KEY, JSON.stringify(DB));
    }

    let DB = load();

    // bind inputs
    const bind = (id, key) => {
      const el = document.getElementById(id);
      el.value = DB[key] ?? "";
      el.addEventListener("input", ()=>{ DB[key] = el.value; save(); });
      el.addEventListener("change", ()=>{ DB[key] = el.value; save(); });
      return el;
    };

    bind("cvVersion","cvVersion");
    bind("cvLink","cvLink");
    bind("cvBullets","cvBullets");
    bind("cvNotes","cvNotes");

    bind("sopStage","sopStage");
    bind("sopLink","sopLink");
    bind("sopThesis","sopThesis");
    bind("sopOutline","sopOutline");
    bind("sopNotes","sopNotes");

    bind("wsPages","wsPages");
    bind("wsLink","wsLink");
    bind("wsTopic","wsTopic");
    bind("wsAbstract","wsAbstract");
    bind("wsSections","wsSections");
    bind("wsBib","wsBib");

    bind("recPacket","recPacket");
    bind("identity","identity");
    bind("themes","themes");
    bind("evidence","evidence");
    bind("fitNotes","fitNotes");

    // programs table
    const progBody = document.getElementById("progBody");
    function renderPrograms(){
      progBody.innerHTML = DB.programs.map((p, idx)=>`
        <tr>
          <td><input data-kind="program" data-idx="${idx}" data-field="name" value="${escapeHtml(p.name)}" /></td>
          <td><input data-kind="program" data-idx="${idx}" data-field="type" value="${escapeHtml(p.type)}" /></td>
          <td><input data-kind="program" data-idx="${idx}" data-field="deadline" value="${escapeHtml(p.deadline)}" /></td>
          <td><input data-kind="program" data-idx="${idx}" data-field="notes" value="${escapeHtml(p.notes)}" /></td>
          <td>
            <div class="row2" style="gap:8px">
              <input style="flex:1" data-kind="program" data-idx="${idx}" data-field="status" value="${escapeHtml(p.status)}" />
              <button class="btn" style="padding:8px 10px" onclick="removeProgram(${idx});return false;">‚úï</button>
            </div>
          </td>
        </tr>
      `).join("");
    }

    // recommenders table
    const recBody = document.getElementById("recBody");
    function renderRecs(){
      recBody.innerHTML = DB.recommenders.map((r, idx)=>`
        <tr>
          <td><input data-kind="rec" data-idx="${idx}" data-field="name" value="${escapeHtml(r.name)}" /></td>
          <td><input data-kind="rec" data-idx="${idx}" data-field="role" value="${escapeHtml(r.role)}" /></td>
          <td><input data-kind="rec" data-idx="${idx}" data-field="canSay" value="${escapeHtml(r.canSay)}" /></td>
          <td><input data-kind="rec" data-idx="${idx}" data-field="deadline" value="${escapeHtml(r.deadline)}" /></td>
          <td>
            <div class="row2" style="gap:8px">
              <input style="flex:1" data-kind="rec" data-idx="${idx}" data-field="status" value="${escapeHtml(r.status)}" />
              <button class="btn" style="padding:8px 10px" onclick="removeRec(${idx});return false;">‚úï</button>
            </div>
          </td>
        </tr>
      `).join("");
    }

    function escapeHtml(s){
      return String(s ?? "").replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[m]));
    }

    function attachTableListeners(){
      document.querySelectorAll("input[data-kind]").forEach(inp=>{
        inp.addEventListener("input", ()=>{
          const kind = inp.getAttribute("data-kind");
          const idx = parseInt(inp.getAttribute("data-idx"),10);
          const field = inp.getAttribute("data-field");
          if(kind==="program"){
            DB.programs[idx][field] = inp.value;
          }else{
            DB.recommenders[idx][field] = inp.value;
          }
          save();
        });
      });
    }

    window.removeProgram = function(idx){
      DB.programs.splice(idx,1);
      save();
      renderPrograms(); renderRecs();
      attachTableListeners();
    }
    window.removeRec = function(idx){
      DB.recommenders.splice(idx,1);
      save();
      renderPrograms(); renderRecs();
      attachTableListeners();
    }

    document.getElementById("addProgram").onclick = ()=>{
      DB.programs.push({name:"", type:"", deadline:"TBD", notes:"", status:"planning"});
      save();
      renderPrograms(); attachTableListeners();
    };

    document.getElementById("addRec").onclick = ()=>{
      DB.recommenders.push({name:"", role:"", canSay:"", deadline:"TBD", status:"not asked"});
      save();
      renderRecs(); attachTableListeners();
    };

    function toMd(){
      const lines = [];
      lines.push(`# Schola Arcana ‚Äî Dossier\n`);

      lines.push(`## CV`);
      lines.push(`- Version: **${DB.cvVersion || "‚Äî"}**`);
      lines.push(`- File/link: ${DB.cvLink || "‚Äî"}\n`);
      lines.push(`### Key bullets`);
      lines.push(`${(DB.cvBullets||"‚Äî").trim()}\n`);
      lines.push(`### Notes`);
      lines.push(`${(DB.cvNotes||"‚Äî").trim()}\n`);

      lines.push(`## SOP (Statement of Purpose)`);
      lines.push(`- Stage: **${DB.sopStage || "‚Äî"}**`);
      lines.push(`- File/link: ${DB.sopLink || "‚Äî"}`);
      lines.push(`- Thesis: ${DB.sopThesis || "‚Äî"}\n`);
      lines.push(`### Outline`);
      lines.push(`${(DB.sopOutline||"‚Äî").trim()}\n`);
      lines.push(`### Notes`);
      lines.push(`${(DB.sopNotes||"‚Äî").trim()}\n`);

      lines.push(`## Writing sample`);
      lines.push(`- Pages: **${DB.wsPages || "0"}**`);
      lines.push(`- File/link: ${DB.wsLink || "‚Äî"}`);
      lines.push(`- Topic: ${DB.wsTopic || "‚Äî"}\n`);
      lines.push(`### Abstract`);
      lines.push(`${(DB.wsAbstract||"‚Äî").trim()}\n`);
      lines.push(`### Sections`);
      lines.push(`${(DB.wsSections||"‚Äî").trim()}\n`);
      lines.push(`### Bibliography`);
      lines.push(`${(DB.wsBib||"‚Äî").trim()}\n`);

      lines.push(`## Programs & deadlines`);
      DB.programs.forEach((p,i)=>{
        lines.push(`- **${p.name || "Program"}** (${p.type || "‚Äî"}) ‚Äî Deadline: ${p.deadline || "TBD"} ‚Äî Status: ${p.status || "‚Äî"}`);
        if(p.notes) lines.push(`  - Notes: ${p.notes}`);
      });
      lines.push("");

      lines.push(`## Recommenders`);
      DB.recommenders.forEach((r,i)=>{
        lines.push(`- **${r.name || "Name"}** ‚Äî ${r.role || "‚Äî"} ‚Äî Deadline: ${r.deadline || "TBD"} ‚Äî Status: ${r.status || "‚Äî"}`);
        if(r.canSay) lines.push(`  - Can say: ${r.canSay}`);
      });
      lines.push("");

      lines.push(`### Recommender packet checklist`);
      lines.push(`${(DB.recPacket||"‚Äî").trim()}\n`);

      lines.push(`## Coherence sheet`);
      lines.push(`### Identity`);
      lines.push(`${(DB.identity||"‚Äî").trim()}\n`);
      lines.push(`### Research themes`);
      lines.push(`${(DB.themes||"‚Äî").trim()}\n`);
      lines.push(`### Evidence list`);
      lines.push(`${(DB.evidence||"‚Äî").trim()}\n`);
      lines.push(`### Program fit notes template`);
      lines.push(`${(DB.fitNotes||"‚Äî").trim()}\n`);

      return lines.join("\n");
    }

    async function copy(text, btn){
      try{
        await navigator.clipboard.writeText(text);
        const old = btn.textContent;
        btn.textContent = "Copied ‚ú®";
        setTimeout(()=>btn.textContent = old, 900);
      }catch{
        alert("Copy failed. You can still manually copy after selecting the text.");
      }
    }

    document.getElementById("exportBtn").onclick = ()=>{
      copy(toMd(), document.getElementById("exportBtn"));
    };

    document.getElementById("exportPrograms").onclick = ()=>{
      const md = DB.programs.map(p=>`- ${p.name} | ${p.type} | ${p.deadline} | ${p.status} | ${p.notes}`).join("\n");
      copy(md, document.getElementById("exportPrograms"));
    };

    document.getElementById("exportRecs").onclick = ()=>{
      const md = DB.recommenders.map(r=>`- ${r.name} | ${r.role} | ${r.deadline} | ${r.status} | ${r.canSay}`).join("\n");
      copy(md, document.getElementById("exportRecs"));
    };

    document.getElementById("resetBtn").onclick = ()=>{
      if(confirm("Reset dossier (everything)?")){
        DB = structuredClone(DEFAULT);
        localStorage.removeItem(KEY);
        location.reload();
      }
    };

    document.getElementById("printBtn").onclick = ()=> window.print();

    // initial render
    renderPrograms();
    renderRecs();
    attachTableListeners();
  </script>
</body>
</html>